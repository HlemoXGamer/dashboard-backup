image: node:14

pipelines:
  branches:
    production: # Change 'production' to your target branch name
      - step:
          name: Deploy to Remote Server
          script:
            # Install SSH client
            - apt-get update && apt-get install -y openssh-client

            # Add SSH private key
            - echo "$SSH_PRIVATE_KEY" | tr -d '\r' > ~/.ssh/id_rsa
            - chmod 600 ~/.ssh/id_rsa

            # Add the remote server to known hosts
            - ssh-keyscan -H 164.92.88.138 >> ~/.ssh/known_hosts

            # Deploy to the remote server
            - scp -r ./* $SSH_USER@164.92.88.138:/var/www/Sable/dashboard
            
             # Run npm run build after deploying
            - ssh $SSH_USER@your_server_ip "cd /path/to/remote/directory && nvm use v14.21.3 && npm i && npm run build"